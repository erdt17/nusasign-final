<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BISINDO Translator - Penerjemah Bahasa Isyarat Indonesia</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --card-bg: rgba(255, 255, 255, 0.95);
            --border-radius: 16px;
            --box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 20px;
            animation: fadeIn 1s ease;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .logo-icon {
            font-size: 2.8rem;
            color: white;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        h1 {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(45deg, #ffffff, #e0e0ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            max-width: 600px;
            margin: 0 auto;
            font-weight: 300;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        @media (min-width: 992px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            transition: var(--transition);
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .card-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title i {
            font-size: 1.8rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .camera-container {
            position: relative;
            width: 100%;
            padding-top: 75%; /* 4:3 Aspect Ratio */
            background: linear-gradient(45deg, #3a56d4, #764ba2);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        #video, #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: var(--border-radius);
            transform: rotateY(180deg); /* Mirror video */
        }

        .camera-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #3a56d4, #764ba2);
            color: rgba(255, 255, 255, 0.9);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
        }

        .camera-placeholder i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: white;
            opacity: 0.8;
        }

        .camera-placeholder p {
            font-size: 1.2rem;
            font-weight: 500;
            max-width: 300px;
        }

        .camera-error {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: var(--border-radius);
            display: none;
            z-index: 10;
        }

        .prediction-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 25px;
            margin: 25px 0;
            background: linear-gradient(to right, #eef2ff, #f0f9ff);
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
        }

        .prediction-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .prediction-label {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 15px;
            font-weight: 500;
        }

        .prediction-result {
            font-size: 5.5rem;
            font-weight: 800;
            color: var(--primary);
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 3px 6px rgba(67, 97, 238, 0.3);
            font-family: 'Arial Rounded MT Bold', 'Segoe UI', sans-serif;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            padding: 16px 32px;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            font-size: 1.05rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex: 1;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            transform: translateY(-3px);
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-loading {
            background-color: rgba(255, 243, 205, 0.9);
            color: #856404;
        }

        .status-success {
            background-color: rgba(212, 237, 218, 0.9);
            color: #155724;
        }

        .status-error {
            background-color: rgba(248, 215, 218, 0.9);
            color: #721c24;
        }

        .status i {
            font-size: 1.3rem;
        }

        .translator-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex: 1;
        }

        .direction-selector {
            display: flex;
            background-color: var(--light-gray);
            border-radius: 50px;
            padding: 6px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        .direction-btn {
            flex: 1;
            padding: 14px;
            border: none;
            background: none;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

        .direction-btn.active {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 3px 10px rgba(67, 97, 238, 0.3);
        }

        textarea {
            width: 100%;
            padding: 18px;
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            resize: vertical;
            min-height: 140px;
            transition: var(--transition);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(76, 201, 240, 0.3);
        }

        .translate-btn {
            background: linear-gradient(45deg, var(--secondary), var(--primary));
            color: white;
            width: 100%;
            padding: 18px;
            font-size: 1.15rem;
            font-weight: 600;
            margin-top: 10px;
        }

        .translate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(114, 9, 183, 0.4);
        }

        .result-container {
            margin-top: 25px;
            padding: 25px;
            background: linear-gradient(to right, #f0f4ff, #f5f7ff);
            border-radius: var(--border-radius);
            min-height: 160px;
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
        }

        .result-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
        }

        .result-title {
            font-size: 1.2rem;
            color: var(--secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .result-text {
            font-size: 1.5rem;
            font-weight: 600;
            flex: 1;
            display: flex;
            align-items: center;
            color: #444;
        }

        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .keypoint-info {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            color: var(--gray);
            font-size: 1rem;
            font-weight: 500;
        }

        .hands-count {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .loading-spinner {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 3px solid rgba(67, 97, 238, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .alphabet-guide {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(42px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .alphabet-item {
            background-color: var(--light);
            border-radius: 10px;
            padding: 10px 5px;
            text-align: center;
            font-weight: 700;
            font-size: 1.3rem;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            transition: var(--transition);
            cursor: default;
        }

        .alphabet-item:hover {
            transform: translateY(-5px);
        }

        .detected {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            transform: scale(1.15) translateY(-5px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
            z-index: 2;
        }

        .guide-box {
            margin-top: 30px;
            background: linear-gradient(to bottom, #f0f9ff, #e4f2ff);
            padding: 25px;
            border-radius: var(--border-radius);
            border-left: 5px solid var(--accent);
        }

        .guide-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.3rem;
            font-weight: 600;
        }

        .guide-list {
            padding-left: 25px;
            display: grid;
            gap: 12px;
        }

        .guide-list li {
            display: flex;
            gap: 12px;
            font-size: 1.05rem;
            color: #555;
            font-weight: 500;
        }

        .guide-list li::before {
            content: '•';
            color: var(--accent);
            font-weight: bold;
            font-size: 1.5rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .detection-animation {
            animation: pulse 0.5s ease;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.3rem;
            }
            
            .card-title {
                font-size: 1.4rem;
            }
            
            .prediction-result {
                font-size: 4.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-hands"></i>
                </div>
                <h1>BISINDO Translator</h1>
            </div>
            <p class="subtitle">Penerjemah Bahasa Isyarat Indonesia secara real-time menggunakan AI. Tampilkan isyarat huruf A-Z di depan kamera untuk dikenali.</p>
        </header>

        <div class="main-content">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-camera"></i> Deteksi Bahasa Isyarat</h2>
                
                <div class="camera-container">
                    <video id="video" autoplay playsinline></video>
                    <canvas id="canvas"></canvas>
                    <div class="camera-placeholder" id="camera-placeholder">
                        <i class="fas fa-camera pulse"></i>
                        <p>Klik "Mulai Deteksi" untuk mengaktifkan kamera</p>
                    </div>
                    <div class="camera-error" id="camera-error"></div>
                </div>
                
                <div class="prediction-container">
                    <div class="prediction-label">HURUF YANG DIDETEKSI</div>
                    <div class="prediction-result" id="prediction-result">-</div>
                </div>
                
                <div class="keypoint-info">
                    <div class="model-status" id="model-status">
                        <div class="status status-loading">
                            <div class="loading-spinner"></div>
                            <span>Memuat model AI...</span>
                        </div>
                    </div>
                    <div class="hands-count">
                        <i class="fas fa-hand-paper"></i> <span id="hands-count">0 tangan terdeteksi</span>
                    </div>
                </div>
                
                <div class="controls">
                    <button id="start-btn" class="btn btn-primary">
                        <i class="fas fa-play"></i> Mulai Deteksi
                    </button>
                    <button id="reset-btn" class="btn btn-outline">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
                
                <div class="alphabet-guide" id="alphabet-guide">
                    <!-- Huruf A-Z akan diisi oleh JavaScript -->
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-language"></i> Penerjemah Teks</h2>
                
                <div class="translator-container">
                    <div class="direction-selector">
                        <button id="id-to-su" class="direction-btn active">Indonesia → Sunda</button>
                        <button id="su-to-id" class="direction-btn">Sunda → Indonesia</button>
                    </div>
                    
                    <textarea id="input-text" placeholder="Masukkan teks untuk diterjemahkan..."></textarea>
                    
                    <button id="translate-btn" class="btn translate-btn">
                        <i class="fas fa-exchange-alt"></i> Terjemahkan Sekarang
                    </button>
                    
                    <div class="result-container">
                        <div class="result-title"><i class="fas fa-file-alt"></i> Hasil Terjemahan</div>
                        <div class="result-text" id="translation-result">Hasil terjemahan akan muncul di sini</div>
                    </div>
                </div>
                
                <div class="guide-box">
                    <h3 class="guide-title">
                        <i class="fas fa-lightbulb"></i> Panduan Penggunaan
                    </h3>
                    <ul class="guide-list">
                        <li>Izinkan akses kamera ketika diminta oleh browser</li>
                        <li>Pastikan pencahayaan ruangan cukup dan merata</li>
                        <li>Tunjukkan satu tangan atau dua tangan sesuai huruf yang ingin dideteksi</li>
                        <li>Jarak tangan dengan kamera sekitar 30-80 cm</li>
                        <li>Gunakan latar belakang polos untuk hasil terbaik</li>
                        <li>Pastikan seluruh tangan terlihat jelas di frame kamera</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Proyek BISINDO Translator - Sistem Deteksi Bahasa Isyarat Indonesia Berbasis AI</p>
            <p>© 2023 - Dibangun dengan TensorFlow.js dan Mediapipe | Versi 2.0</p>
        </footer>
    </div>

    <!-- TensorFlow.js Versi 4.12.0 -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
    
    <!-- Mediapipe Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    
    <script>
        // Impor fungsi yang diperlukan dari Mediapipe
        const { 
            HAND_CONNECTIONS, 
            drawConnectors, 
            drawLandmarks 
        } = window;

        // Elemen DOM
        const videoElement = document.getElementById('video');
        const canvasElement = document.getElementById('canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const predictionResult = document.getElementById('prediction-result');
        const startButton = document.getElementById('start-btn');
        const resetButton = document.getElementById('reset-btn');
        const modelStatus = document.getElementById('model-status');
        const handsCount = document.getElementById('hands-count');
        const alphabetGuide = document.getElementById('alphabet-guide');
        const inputText = document.getElementById('input-text');
        const translateButton = document.getElementById('translate-btn');
        const translationResult = document.getElementById('translation-result');
        const directionButtons = document.querySelectorAll('.direction-btn');
        const cameraPlaceholder = document.getElementById('camera-placeholder');
        const cameraError = document.getElementById('camera-error');
        
        // State variabel
        let model = null;
        let hands = null;
        let isDetecting = false;
        let detectionInterval = null;
        let currentLetter = null;
        let translationDirection = 'id-to-su';
        let cameraStream = null;
        
        // Inisialisasi panduan alfabet
        function initAlphabetGuide() {
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let html = '';
            
            for (let i = 0; i < alphabet.length; i++) {
                html += `<div class="alphabet-item" data-letter="${alphabet[i]}">${alphabet[i]}</div>`;
            }
            
            alphabetGuide.innerHTML = html;
        }
        
        // Memuat model TensorFlow.js dengan penanganan error yang lebih baik
async function loadModel() {
  try {
    modelStatus.innerHTML = `
      <div class="status status-loading">
        <div class="loading-spinner"></div>
        <span>Memuat model AI...</span>
      </div>
    `;

    model = await tf.loadGraphModel('./model/model.json');

    console.log(`Model berhasil dimuat!`);

    modelStatus.innerHTML = `
      <div class="status status-success">
        <i class="fas fa-check-circle"></i> 
        <span>Model AI berhasil dimuat!</span>
      </div>
    `;

  } catch (error) {
    console.error("Gagal memuat model:", error);
    modelStatus.innerHTML = `
      <div class="status status-error">
        <i class="fas fa-exclamation-circle"></i> 
        <span>Gagal memuat model AI: ${error}</span>
      </div>
    `;
  }
}
            try {
                modelStatus.innerHTML = `
                    <div class="status status-loading">
                        <div class="loading-spinner"></div>
                        <span>Memuat model AI...</span>
                    </div>
                `;
                
                // Daftar path alternatif untuk model
                const modelPaths = [
                    './model/model.json',
                    '/model/model.json',
                    'model/model.json',
                    'model.json'
                ];
                
                let modelLoaded = false;
                let lastError = null;
                
                // Coba semua path alternatif
                for (const path of modelPaths) {
                    try {
                        model = await tf.loadGraphModel(path);
                        console.log(`Model berhasil dimuat dari: ${path}`);
                        modelLoaded = true;
                        
                        // Update status setelah berhasil
                        modelStatus.innerHTML = `
                            <div class="status status-success">
                                <i class="fas fa-check-circle"></i> 
                                <span>Model AI berhasil dimuat!</span>
                            </div>
                        `;
                        
                        break;
                    } catch (error) {
                        console.error(`Gagal memuat model dari ${path}:`, error);
                        lastError = error;
                    }
                }
                
                if (!modelLoaded) {
                    throw lastError || new Error('Semua path model gagal dimuat');
                }
                
            } catch (error) {
                console.error("Gagal memuat model:", error);
                
                // Pesan error spesifik
                let errorMsg = "Gagal memuat model AI";
                if (error.message.includes('Failed to fetch')) {
                    errorMsg = "File model tidak ditemukan. Pastikan folder 'model' dengan file model.json dan bin ada";
                } else if (error.message.includes('404')) {
                    errorMsg = "File model tidak ditemukan (Error 404)";
                } else if (error.message.includes('dtype')) {
                    errorMsg = "Versi TensorFlow.js tidak kompatibel. Gunakan v4.12.0";
                }
                
                modelStatus.innerHTML = `
                    <div class="status status-error">
                        <i class="fas fa-exclamation-circle"></i> 
                        <span>${errorMsg}</span>
                    </div>
                `;
            }
        
        // Inisialisasi Mediapipe Hands
        function initHands() {
            hands = new Hands({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                }
            });
            
            hands.setOptions({
                maxNumHands: 2,
                modelComplexity: 1,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });
            
            hands.onResults(onHandsResults);
            
            console.log("Mediapipe Hands diinisialisasi");
        }
        
        // Callback untuk hasil deteksi tangan
        function onHandsResults(results) {
            // Gambar hasil ke canvas
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            
            // Pastikan canvas memiliki ukuran yang sama dengan video
            if (videoElement.videoWidth) {
                canvasElement.width = videoElement.videoWidth;
                canvasElement.height = videoElement.videoHeight;
            }
            
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
            
            if (results.multiHandLandmarks) {
                // Update jumlah tangan yang terdeteksi
                handsCount.textContent = `${results.multiHandLandmarks.length} tangan terdeteksi`;
                
                // Gambar landmark tangan
                for (const landmarks of results.multiHandLandmarks) {
                    drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {
                        color: '#00FF00',
                        lineWidth: 2
                    });
                    drawLandmarks(canvasCtx, landmarks, {
                        color: '#FF0000',
                        lineWidth: 1,
                        radius: 4
                    });
                }
                
                // Proses landmark untuk prediksi
                processLandmarks(results.multiHandLandmarks);
            } else {
                handsCount.textContent = "0 tangan terdeteksi";
                predictionResult.textContent = "-";
            }
            
            canvasCtx.restore();
        }
        
        // Normalisasi landmark tangan
        function normalizeLandmarks(landmarks) {
            const normalized = [];
            
            // Untuk setiap tangan (maks 2)
            for (let handIndex = 0; handIndex < 2; handIndex++) {
                if (handIndex < landmarks.length) {
                    const hand = landmarks[handIndex];
                    for (const point of hand) {
                        normalized.push(point.x, point.y, point.z);
                    }
                } else {
                    // Isi dengan nol untuk tangan yang tidak ada
                    for (let i = 0; i < 21; i++) {
                        normalized.push(0, 0, 0);
                    }
                }
            }
            
            // Pastikan panjangnya 126 (2 tangan * 21 landmark * 3 koordinat)
            return normalized.slice(0, 126);
        }
        
        // Proses landmark untuk prediksi
        async function processLandmarks(landmarks) {
            if (!model || landmarks.length === 0) {
                predictionResult.textContent = "-";
                return;
            }
            
            try {
                // Normalisasi landmark
                const normalized = normalizeLandmarks(landmarks);
                
                // Buat tensor input
                const input = tf.tensor2d([normalized], [1, 126]);
                
                // Lakukan prediksi
                const prediction = model.predict(input);
                const scores = await prediction.data();
                
                // Temukan huruf dengan skor tertinggi
                let maxIndex = 0;
                let maxScore = scores[0];
                
                for (let i = 1; i < scores.length; i++) {
                    if (scores[i] > maxScore) {
                        maxScore = scores[i];
                        maxIndex = i;
                    }
                }
                
                // Konversi indeks ke huruf (A=0, B=1, ..., Z=25)
                const letter = String.fromCharCode(65 + maxIndex);
                currentLetter = letter;
                
                // Update UI dengan animasi
                predictionResult.textContent = letter;
                predictionResult.classList.add('detection-animation');
                setTimeout(() => {
                    predictionResult.classList.remove('detection-animation');
                }, 500);
                
                // Highlight huruf di panduan alfabet
                document.querySelectorAll('.alphabet-item').forEach(item => {
                    item.classList.remove('detected');
                    if (item.dataset.letter === letter) {
                        item.classList.add('detected');
                    }
                });
                
                // Bersihkan tensor
                tf.dispose([input, prediction]);
                
            } catch (error) {
                console.error("Prediksi error:", error);
                predictionResult.textContent = "!";
            }
        }
        
        // Memulai deteksi
        async function startDetection() {
            if (isDetecting) return;
            
            try {
                // Dapatkan akses ke kamera
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: "user",
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: false
                });
                
                videoElement.srcObject = cameraStream;
                isDetecting = true;
                startButton.innerHTML = '<i class="fas fa-stop"></i> Berhenti Deteksi';
                cameraPlaceholder.style.display = 'none';
                cameraError.style.display = 'none';
                
                // Tunggu video siap
                await new Promise(resolve => {
                    videoElement.onloadedmetadata = () => {
                        videoElement.play().then(resolve);
                    };
                });
                
                // Mulai deteksi tangan
                detectionInterval = setInterval(() => {
                    if (videoElement.readyState >= videoElement.HAVE_ENOUGH_DATA) {
                        hands.send({ image: videoElement });
                    }
                }, 100);
                
                console.log("Deteksi dimulai");
                
            } catch (error) {
                console.error("Error mengakses kamera:", error);
                cameraError.style.display = 'flex';
                cameraError.innerHTML = `
                    <div>
                        <p><i class="fas fa-exclamation-triangle"></i> Gagal mengakses kamera</p>
                        <p>${error.name}: ${error.message}</p>
                        <p style="margin-top: 15px; font-size: 1.1rem;">
                            <i class="fas fa-info-circle"></i> Pastikan Anda memberikan izin akses kamera
                        </p>
                        <p style="margin-top: 10px; font-size: 0.9rem;">
                            Jika izin sudah diberikan, coba periksa apakah kamera sedang digunakan oleh aplikasi lain.
                        </p>
                    </div>
                `;
                startButton.innerHTML = '<i class="fas fa-exclamation-circle"></i> Gagal Akses Kamera';
                startButton.disabled = true;
            }
        }
        
        // Menghentikan deteksi
        function stopDetection() {
            if (!isDetecting) return;
            
            clearInterval(detectionInterval);
            isDetecting = false;
            startButton.innerHTML = '<i class="fas fa-play"></i> Mulai Deteksi';
            cameraPlaceholder.style.display = 'flex';
            
            // Hentikan stream kamera
            if (cameraStream) {
                const tracks = cameraStream.getTracks();
                tracks.forEach(track => track.stop());
                videoElement.srcObject = null;
                cameraStream = null;
            }
            
            console.log("Deteksi dihentikan");
        }
        
        // Reset deteksi
        function resetDetection() {
            predictionResult.textContent = "-";
            currentLetter = null;
            document.querySelectorAll('.alphabet-item').forEach(item => {
                item.classList.remove('detected');
            });
            
            console.log("Deteksi direset");
        }
        
        // Fungsi penerjemahan sederhana (Indonesia-Sunda)
        function translateText(text, direction) {
            const dictionary = {
                'id-to-su': {
                    'selamat pagi': 'wilujeng énjing',
                    'apa kabar': 'kumaha damang',
                    'terima kasih': 'hatur nuhun',
                    'saya': 'abdi',
                    'kamu': 'anjeun',
                    'makan': 'dahar',
                    'minum': 'inum',
                    'rumah': 'imah',
                    'jalan': 'jalan',
                    'besar': 'ageung',
                    'kecil': 'alit',
                    'baik': 'alus',
                    'buruk': 'goréng',
                    'ya': 'enya',
                    'tidak': 'henteu',
                    'satu': 'hiji',
                    'dua': 'dua',
                    'tiga': 'tilu',
                    'nama': 'ngaran',
                    'siapa': 'saha',
                    'tolong': 'punten',
                    'maaf': 'hapunten'
                },
                'su-to-id': {
                    'wilujeng énjing': 'selamat pagi',
                    'kumaha damang': 'apa kabar',
                    'hatur nuhun': 'terima kasih',
                    'abdi': 'saya',
                    'anjeun': 'kamu',
                    'dahar': 'makan',
                    'inum': 'minum',
                    'imah': 'rumah',
                    'jalan': 'jalan',
                    'ageung': 'besar',
                    'alit': 'kecil',
                    'alus': 'baik',
                    'goréng': 'buruk',
                    'enya': 'ya',
                    'henteu': 'tidak',
                    'hiji': 'satu',
                    'dua': 'dua',
                    'tilu': 'tiga',
                    'ngaran': 'nama',
                    'saha': 'siapa',
                    'punten': 'tolong',
                    'hapunten': 'maaf'
                }
            };
            
            // Pilih kamus berdasarkan arah terjemahan
            const dict = dictionary[direction];
            
            // Terjemahkan teks per kata/frasa
            let translated = text;
            
            // Coba terjemahkan frasa terlebih dahulu
            for (const phrase in dict) {
                const regex = new RegExp(phrase, 'gi');
                translated = translated.replace(regex, dict[phrase]);
            }
            
            return translated;
        }
        
        // Event Listeners
        startButton.addEventListener('click', () => {
            if (isDetecting) {
                stopDetection();
            } else {
                startDetection();
            }
        });
        
        resetButton.addEventListener('click', resetDetection);
        
        directionButtons.forEach(button => {
            button.addEventListener('click', () => {
                directionButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                translationDirection = button.id;
                // Reset hasil terjemahan saat mengubah arah
                translationResult.textContent = "Hasil terjemahan akan muncul di sini";
            });
        });
        
        translateButton.addEventListener('click', () => {
            if (inputText.value.trim()) {
                const translated = translateText(inputText.value, translationDirection);
                translationResult.textContent = translated;
                
                // Animasi hasil
                translationResult.parentElement.classList.add('detection-animation');
                setTimeout(() => {
                    translationResult.parentElement.classList.remove('detection-animation');
                }, 500);
            } else {
                translationResult.textContent = "Masukkan teks terlebih dahulu";
            }
        });
        
        // Inisialisasi aplikasi saat halaman dimuat
        window.addEventListener('load', async () => {
            initAlphabetGuide();
            initHands();
            await loadModel();
            
            // Animasi elemen saat dimuat
            document.querySelectorAll('.card').forEach((card, index) => {
                card.style.animation = `fadeIn 0.5s ease ${index * 0.2}s forwards`;
                card.style.opacity = 0;
            });
        });
    </script>
</body>
</html>